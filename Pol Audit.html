import React, { useState, useMemo } from 'react';
import { 
  Search, Info, ExternalLink, Filter, 
  RotateCcw, CheckCircle2, XCircle, AlertCircle, History,
  ChevronDown, ChevronUp, ChevronRight, Layers, FileText, Globe,
  TrendingUp, Wallet, ShieldCheck, Scale, Leaf, Users,
  MapPin, BookOpen, Landmark, GraduationCap, Building2,
  Stethoscope, Tractor, Zap, Trash2, Bus, Fish, LayoutGrid, List,
  ArrowRightLeft, Coins, AlertTriangle, Sparkles, PieChart
} from 'lucide-react';

const App = () => {
  const [activeTab, setActiveTab] = useState('manifesto-505');
  const [searchQuery, setSearchQuery] = useState('');
  const [expandedItem, setExpandedItem] = useState(null);
  const [selectedScope, setSelectedScope] = useState('All');

  // --- 1. DATA: MANIFESTO 505 (Consolidated 2021-2026 Audit) ---
  const manifesto505 = [
    // GOVERNANCE: STATE RIGHTS
    { id: 1, scope: "Top Level", category: "Governance", subCategory: "State Rights", promise: "Restore lost state rights; remove 'Education' from Concurrent List", status: "Stalled", details: "Requires Constitutional amendment; Union non-cooperation cited in 2026 Audit.", constituency: "State-wide" },
    { id: 2, scope: "Top Level", category: "Governance", subCategory: "State Rights", promise: "Oppose NEP; Formulate separate State Education Policy", status: "Achieved", details: "High-level committee draft submitted 2024; implementation in syllabus ongoing.", constituency: "State-wide" },
    { id: 3, scope: "Top Level", category: "Governance", subCategory: "State Rights", promise: "Retrieval of Katchatheevu Island", status: "Stalled", details: "Requires Union diplomatic intervention with Sri Lanka.", constituency: "State-wide" },
    
    // GOVERNANCE: LANGUAGE
    { id: 4, scope: "Top Level", category: "Governance", subCategory: "Language", promise: "Declare Tamil as an official language of the Union Govt", status: "Stalled", details: "Pending amendment to Article 343.", constituency: "State-wide" },
    { id: 5, scope: "Other", category: "Governance", subCategory: "Language", promise: "Tamil as co-official language in Central Govt offices in TN", status: "Stalled", details: "Union Govt has not accepted the proposal.", constituency: "State-wide" },
    { id: 12, scope: "Other", category: "Governance", subCategory: "Language", promise: "Separate wing for Tamil as Official Language in all State depts", status: "Achieved", details: "Established across all 30+ major departments.", constituency: "State-wide" },

    // GOVERNANCE: EMPLOYEES
    { id: 501, scope: "Top Level", category: "Governance", subCategory: "Employees", promise: "Restoration of Old Pension Scheme (OPS)", status: "Pending", details: "Committee report submitted; evaluation of fiscal impact ongoing (Jan 2026).", constituency: "State-wide" },
    { id: 502, scope: "Other", category: "Governance", subCategory: "Employees", promise: "Filling up of 3.5 lakh vacancies in Govt departments", status: "Partial", details: "Approx 44,000 recruited as of late 2025; opposition claims 15,000 are temporary.", constituency: "State-wide" },

    // EDUCATION
    { id: 45, scope: "Top Level", category: "Education", subCategory: "School", promise: "Morning Breakfast Scheme for all Primary Students (Classes 1-5)", status: "Achieved", details: "Successfully implemented in 31,000+ govt primary schools.", constituency: "State-wide" },
    { id: 48, scope: "Top Level", category: "Education", subCategory: "Access", promise: "Abolition of NEET Exam for Tamil Nadu", status: "Stalled", details: "Bill passed twice; awaiting Presidential assent. Union-State conflict.", constituency: "State-wide" },
    { id: 62, scope: "Other", category: "Education", subCategory: "College", promise: "₹1,000 monthly stipend for girl students (Puthumai Penn)", status: "Achieved", details: "Benefitting 1.15L students annually from 2022 onwards.", constituency: "State-wide" },

    // ECONOMY & WELFARE
    { id: 205, scope: "Top Level", category: "Economy", subCategory: "Welfare", promise: "₹1,000 monthly allowance for women (Magalir Urimai Thogai)", status: "Achieved", details: "Flagship scheme active for 1.16 Crore eligible women heads of families.", constituency: "State-wide" },
    { id: 201, scope: "Top Level", category: "Economy", subCategory: "Fuel", promise: "Reduction of Petrol price by ₹3/litre", status: "Achieved", details: "Implemented in the 2021 revised budget.", constituency: "State-wide" },
    { id: 208, scope: "Top Level", category: "Economy", subCategory: "LPG", promise: "₹100 subsidy for Cooking Gas cylinders", status: "Not Started", details: "Official status: Not taken up due to 'unconducive fiscal atmosphere'.", constituency: "State-wide" }
  ];

  // --- 2. DATA: CONTINUITY AUDIT (Legacy vs Current) ---
  const continuityData = [
    { 
      id: "c1", 
      type: "Continued", 
      legacyName: "Amma Unavagam (Launched 2013 - AIADMK)", 
      currentName: "Amma Unavagam (Maintained by DMK)", 
      allocationDelta: "+5% (Inflationary buffer)", 
      status: "Achieved",
      details: "Retained due to deep urban popularity. Branding kept but expanded via 'Kalaignar Unavagams' in new areas.",
      fiscal21: "₹100 Cr", fiscal25: "₹105 Cr"
    },
    { 
      id: "c2", 
      type: "Repealed", 
      legacyName: "Amma Two-Wheeler Scheme (Launched 2018 - AIADMK)", 
      currentName: "Discontinued", 
      reasoning: "High maintenance costs and lower beneficiary reach per rupee spent.",
      moneySaved: "₹500 Cr / Per Annum",
      unintendedConsequences: "AI ANALYSIS: Marginal drop in independent last-mile mobility for women in areas without 'Vidiyal Payanam' bus frequency.",
      replacement: "Free Bus Travel for Women"
    },
    { 
      id: "c3", 
      type: "Rebranded", 
      legacyName: "Thalikku Thangam (Marriage Gold Scheme)", 
      currentName: "Puthumai Penn (Higher Education Support)", 
      allocationDelta: "+12% Budget Redirection", 
      status: "Achieved",
      details: "Transition from marriage welfare to education welfare. Gold gift replaced by monthly ₹1,000.",
      fiscal21: "₹760 Cr", fiscal25: "₹850 Cr"
    }
  ];

  // --- 3. DATA: CONSTITUENCY AUDIT ---
  const constituencyWorks = [
    { 
      name: "Kolathur", 
      mla: "M.K. Stalin (DMK)", 
      totalSpent: "₹15.2 Cr", 
      verifiedAt: "GOC District Audit Portal",
      majorWork: "Integrated Storm Water Drain (Phase 2)",
      fundingSource: "MLADS (₹3 Cr) + State Special Fund (₹12.2 Cr)",
      overlap: "Minimal. MP funds used for Railway Passenger Amenities at station.",
      linkedPromises: [1, 45, 205] 
    },
    { 
      name: "Edappadi", 
      mla: "E.K. Palaniswami (AIADMK)", 
      totalSpent: "₹9.1 Cr", 
      verifiedAt: "Salem District Collectorate RTI",
      majorWork: "Mettur-Sarabanga Lift Irrigation Link",
      fundingSource: "MLADS (₹3 Cr) + Rural Infrastructure Fund",
      overlap: "High. MP funds also utilized for rural road electrification in same blocks.",
      linkedPromises: [101]
    }
  ];

  // --- 4. DATA: FISCAL TIMELINE ---
  const budgetData = [
    { year: "2025-26", total: "₹4.39 Lakh Cr", focus: "Youth, Digital & Agriculture", links: ["Puthumai Penn", "Smart Classroom"] },
    { year: "2024-25", total: "₹4.12 Lakh Cr", focus: "Social Welfare & Health", links: ["Magalir Urimai", "Makkalai Thedi"] },
    { year: "2023-24", total: "₹3.80 Lakh Cr", focus: "Infrastructure & Roads", links: ["Housing", "Highway Links"] },
    { year: "2022-23", total: "₹3.40 Lakh Cr", focus: "Post-Pandemic Recovery", links: ["Education Bridge"] },
    { year: "2021-22", total: "₹3.10 Lakh Cr", focus: "Manifesto Initialization", links: ["Petrol Cut", "Loan Waiver"] }
  ];

  const categories = [
    { name: 'Governance', sub: ['State Rights', 'Language', 'Employees'] },
    { name: 'Education', sub: ['School', 'College', 'Access'] },
    { name: 'Economy', sub: ['Fuel', 'Welfare', 'LPG'] }
  ];

  const filteredManifesto = useMemo(() => {
    return manifesto505.filter(p => {
      const matchesSearch = p.promise.toLowerCase().includes(searchQuery.toLowerCase());
      const matchesScope = selectedScope === 'All' || p.scope === selectedScope;
      return matchesSearch && matchesScope;
    });
  }, [searchQuery, selectedScope]);

  const getStatusStyles = (status) => {
    switch(status) {
      case 'Achieved': return 'bg-green-500 text-white border-green-600';
      case 'Pending': return 'bg-amber-500 text-white border-amber-600';
      case 'Stalled': return 'bg-red-500 text-white border-red-600';
      case 'Not Started': return 'bg-white text-slate-400 border-slate-200';
      default: return 'bg-slate-100 text-slate-600 border-slate-200';
    }
  };

  return (
    <div className="min-h-screen bg-[#fcfcfd] text-slate-900 font-sans flex flex-col">
      <header className="bg-white border-b border-slate-100 sticky top-0 z-50">
        <div className="max-w-6xl mx-auto px-6 h-16 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <h1 className="text-xl font-black tracking-tight text-slate-900 leading-none">POLITRACK 505</h1>
            <div className="h-4 w-px bg-slate-200"></div>
            <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest uppercase">Jan 2026 Audit</span>
          </div>
          <div className="flex gap-1 bg-slate-100 p-1 rounded-lg">
             {[
               { id: 'manifesto-505', label: 'Manifesto' },
               { id: 'continuity', label: 'Continuity' },
               { id: 'constituency', label: 'Constituency' },
               { id: 'budget', label: 'Budget' }
             ].map(tab => (
               <button 
                 key={tab.id}
                 onClick={() => { setActiveTab(tab.id); setExpandedItem(null); }}
                 className={`px-4 py-1.5 rounded-md text-[10px] font-black uppercase tracking-wider transition-all ${
                   activeTab === tab.id ? 'bg-slate-900 text-white shadow-sm' : 'text-slate-500 hover:text-slate-800'
                 }`}
               >
                 {tab.label}
               </button>
             ))}
          </div>
        </div>
      </header>

      <main className="max-w-5xl mx-auto w-full px-6 py-10 flex flex-col gap-10">
        
        {/* --- MANIFESTO TAB --- */}
        {activeTab === 'manifesto-505' && (
          <div className="space-y-12">
            <section className="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm flex justify-between items-center">
               <div>
                 <h2 className="text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Audit Summary (Claimed by Government)</h2>
                 <span className="text-5xl font-black text-slate-900">404 <span className="text-sm font-bold text-slate-300">/ 505</span></span>
               </div>
               <div className="flex flex-col items-end">
                  <div className="text-[10px] font-black text-slate-400 uppercase mb-2">Success Rate</div>
                  <div className="w-32 h-2 bg-slate-100 rounded-full overflow-hidden">
                    <div className="h-full bg-green-500" style={{ width: '80%' }}></div>
                  </div>
               </div>
            </section>

            <div className="flex flex-col md:flex-row gap-4">
              <div className="flex-1 relative">
                <Search className="absolute left-4 top-3.5 text-slate-300" size={18} />
                <input 
                  type="text" 
                  placeholder="Search promises..." 
                  className="w-full pl-12 pr-4 py-3.5 bg-white border border-slate-200 rounded-2xl text-sm font-medium focus:ring-4 focus:ring-slate-100 transition-all"
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                />
              </div>
              <div className="flex gap-2">
                {['All', 'Top Level', 'Other'].map(scope => (
                  <button
                    key={scope}
                    onClick={() => setSelectedScope(scope)}
                    className={`px-6 py-2 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all ${
                      selectedScope === scope ? 'bg-slate-900 text-white shadow-lg' : 'bg-white border border-slate-200 text-slate-500'
                    }`}
                  >
                    {scope}
                  </button>
                ))}
              </div>
            </div>

            <div className="space-y-16">
              {categories.map(cat => {
                const catPromises = filteredManifesto.filter(p => p.category === cat.name);
                if (catPromises.length === 0) return null;

                return (
                  <section key={cat.name} className="space-y-6">
                    <h2 className="text-2xl font-black text-slate-900 tracking-tight flex items-center gap-4">
                       {cat.name} <div className="flex-1 h-px bg-slate-100"></div>
                    </h2>
                    {cat.sub?.map(sub => {
                      const subPromises = catPromises.filter(p => p.subCategory === sub);
                      if (subPromises.length === 0) return null;

                      return (
                        <div key={sub} className="space-y-4">
                          <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] flex items-center gap-2 pl-2">
                            <ChevronRight size={12} className="text-slate-300" /> {sub}
                          </h3>
                          <div className="space-y-2">
                            {subPromises.map((p) => (
                              <div key={p.id} className={`bg-white rounded-2xl border transition-all ${expandedItem === p.id ? 'border-slate-300 ring-8 ring-slate-50 shadow-sm' : 'border-slate-100 hover:border-slate-200'}`}>
                                <div className="p-4 cursor-pointer flex items-center gap-4" onClick={() => setExpandedItem(expandedItem === p.id ? null : p.id)}>
                                  <div className={`shrink-0 px-3 py-1 rounded-lg border text-[9px] font-black uppercase min-w-[90px] text-center ${getStatusStyles(p.status)}`}>{p.status}</div>
                                  <div className="flex-1">
                                    <span className="text-[8px] font-black uppercase text-slate-400 block mb-0.5">{p.scope}</span>
                                    <h4 className="text-sm font-bold text-slate-800 leading-snug">{p.promise}</h4>
                                  </div>
                                  <div className="text-slate-300">{expandedItem === p.id ? <ChevronUp size={20}/> : <ChevronDown size={20}/>}</div>
                                </div>
                                {expandedItem === p.id && (
                                  <div className="px-5 pb-5 animate-in slide-in-from-top-2">
                                    <div className="p-5 bg-slate-50 rounded-2xl border border-slate-100 text-sm text-slate-600 font-medium">
                                      {p.details}
                                    </div>
                                  </div>
                                )}
                              </div>
                            ))}
                          </div>
                        </div>
                      );
                    })}
                  </section>
                );
              })}
            </div>
          </div>
        )}

        {/* --- CONTINUITY TAB (Persistence vs Repeal) --- */}
        {activeTab === 'continuity' && (
          <div className="space-y-8">
            <div className="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm">
               <h2 className="text-xl font-black mb-1">Continuity & Repeal Audit</h2>
               <p className="text-xs text-slate-500 font-medium tracking-wide">Analyzing policy persistence from the 2011-2021 AIADMK period into the 2021-2026 DMK mandate.</p>
            </div>
            <div className="grid gap-6">
               {continuityData.map(item => (
                 <div key={item.id} className="bg-white rounded-[2rem] border border-slate-100 p-8 flex flex-col gap-8 shadow-sm">
                    <div className="flex justify-between items-start">
                       <div className="flex-1">
                          <span className={`text-[9px] font-black uppercase px-2 py-0.5 rounded ${item.type === 'Repealed' ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}`}>{item.type}</span>
                          <h3 className="text-xl font-black mt-2 text-slate-400 line-through decoration-slate-200">{item.legacyName}</h3>
                          {item.currentName !== 'Discontinued' && (
                            <div className="flex items-center gap-2 mt-1">
                               <ArrowRightLeft size={16} className="text-slate-400"/>
                               <h3 className="text-xl font-black text-slate-900">{item.currentName}</h3>
                            </div>
                          )}
                       </div>
                       <div className="text-right">
                          <span className="text-[10px] font-black text-slate-400 uppercase block mb-1">Fiscal Delta</span>
                          <span className="text-lg font-black text-slate-900">{item.allocationDelta || item.moneySaved}</span>
                       </div>
                    </div>
                    <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                       {item.type === 'Repealed' ? (
                         <div className="space-y-6">
                           <p className="text-sm font-medium leading-relaxed"><strong>Legislative Reasoning:</strong> {item.reasoning}</p>
                           <div className="bg-amber-50 p-4 rounded-xl border border-amber-100 flex gap-4 text-xs text-amber-800">
                              <Sparkles className="shrink-0" size={18}/> 
                              <div><strong>AI Unintended Consequences Map:</strong> {item.unintendedConsequences}</div>
                           </div>
                           <div className="flex items-center gap-2 text-xs font-bold text-green-600"><CheckCircle2 size={16}/> Corrective Strategy: {item.replacement}</div>
                         </div>
                       ) : (
                         <div className="grid grid-cols-2 gap-8 text-sm">
                           <div className="p-4 bg-white rounded-xl border border-slate-50"><span className="text-[9px] font-black text-slate-400 block uppercase mb-1">2021 Baseline</span><strong className="text-lg">{item.fiscal21}</strong></div>
                           <div className="p-4 bg-white rounded-xl border border-slate-50"><span className="text-[9px] font-black text-slate-400 block uppercase mb-1">2025 Allocation</span><strong className="text-lg">{item.fiscal25}</strong></div>
                           <p className="col-span-2 text-slate-600 font-medium pt-2">{item.details}</p>
                         </div>
                       )}
                    </div>
                 </div>
               ))}
            </div>
          </div>
        )}

        {/* --- CONSTITUENCY TAB (Hyper-Local Audit) --- */}
        {activeTab === 'constituency' && (
          <div className="space-y-8">
            <div className="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm flex flex-col md:flex-row justify-between gap-6">
               <div>
                  <h2 className="text-xl font-black mb-1 text-slate-900">Constituency Delivery Audit</h2>
                  <p className="text-xs text-slate-500 font-medium tracking-wide">Tracking MLADS (₹3 Cr) and MPLADS (₹5 Cr) distribution and overlaps.</p>
               </div>
               <div className="flex gap-2 h-fit">
                  <div className="px-5 py-2.5 bg-slate-50 border border-slate-200 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-500">MLADS Verified</div>
                  <div className="px-5 py-2.5 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-lg shadow-slate-200">MPLADS Tracker</div>
               </div>
            </div>
            <div className="grid gap-6">
               {constituencyWorks?.map(con => (
                 <div key={con.name} className="bg-white rounded-[2rem] border border-slate-100 p-8 shadow-sm">
                    <div className="flex justify-between items-center mb-10 pb-4 border-b border-slate-50">
                       <h3 className="text-3xl font-black text-slate-900">{con.name}</h3>
                       <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2"><Globe size={14}/> Verified: {con.verifiedAt}</span>
                    </div>
                    <div className="grid md:grid-cols-2 gap-12">
                       <div className="space-y-4">
                          <span className="text-[9px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2"><Coins size={14}/> MLA Performance (Annual MLADS)</span>
                          <div className="flex justify-between items-baseline border-b border-slate-50 pb-2"><span className="font-black text-xl">{con.mla}</span> <span className="text-green-600 font-black text-xl">{con.totalSpent}</span></div>
                          <p className="text-sm font-bold text-slate-800 leading-relaxed">Verified Local Project: {con.majorWork}</p>
                          <p className="text-[10px] text-slate-400 font-mono tracking-tighter">Funding: {con.fundingSource}</p>
                       </div>
                       <div className="border-l border-slate-100 pl-12 space-y-4">
                          <span className="text-[9px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2"><ArrowRightLeft size={14}/> MP Coordination / Overlap Audit</span>
                          <p className="text-sm text-slate-600 font-medium leading-relaxed">{con.overlap}</p>
                          <div className="flex flex-wrap gap-2 pt-4">
                             {con.linkedPromises?.map(id => (
                               <span key={id} className="px-3 py-1.5 bg-slate-900 text-white text-[9px] font-black uppercase rounded-lg">Manifesto Link #{id}</span>
                             ))}
                          </div>
                       </div>
                    </div>
                 </div>
               ))}
            </div>
            <button className="w-full py-8 border-2 border-dashed border-slate-200 rounded-[2.5rem] text-slate-300 text-[10px] font-black uppercase tracking-[0.3em] hover:border-slate-400 hover:text-slate-600 transition-all flex items-center justify-center gap-4">
               <FileText size={20}/> Add New Constituency Work Log / RTI Record
            </button>
          </div>
        )}

        {/* --- BUDGET TAB (Fiscal Foundation) --- */}
        {activeTab === 'budget' && (
          <div className="space-y-8">
            <div className="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm text-center">
               <h2 className="text-4xl font-black text-slate-900 uppercase tracking-tight mb-3">State Budget Timeline</h2>
               <p className="text-[10px] text-slate-400 font-black uppercase tracking-[0.4em]">Bridging Manifesto Claims to Public Spend</p>
            </div>
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
               {budgetData?.map(budget => (
                 <div key={budget.year} className="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm flex flex-col gap-6 hover:border-slate-300 transition-all">
                    <div className="flex justify-between items-center">
                       <span className="text-xl font-black text-slate-400 font-mono">{budget.year}</span>
                       <div className="p-3 bg-slate-50 rounded-2xl"><PieChart className="text-slate-300" size={24}/></div>
                    </div>
                    <div className="text-4xl font-black text-slate-900 tracking-tighter">{budget.total}</div>
                    <div>
                       <span className="text-[9px] font-black uppercase text-slate-400 block mb-1 tracking-widest">Main Priority</span>
                       <p className="text-sm font-bold text-slate-700">{budget.focus}</p>
                    </div>
                    <div className="flex flex-wrap gap-2 mt-auto pt-6 border-t border-slate-50">
                       {budget.links?.map(link => (
                         <span key={link} className="text-[9px] font-black uppercase bg-slate-900 text-white px-3 py-1.5 rounded-full shadow-sm">{link}</span>
                       ))}
                    </div>
                 </div>
               ))}
            </div>
          </div>
        )}
      </main>

      <footer className="bg-white border-t border-slate-100 py-20 mt-20 text-center">
        <p className="text-[10px] text-slate-400 font-black uppercase tracking-[0.4em]">The Governance Transparency Initiative • TN 2026</p>
      </footer>
    </div>
  );
};

export default App;